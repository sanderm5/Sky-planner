---
import BaseLayout from '../layouts/BaseLayout.astro';
import GlassCard from '../components/ui/GlassCard.astro';
import Badge from '../components/ui/Badge.astro';
---

<BaseLayout title="Kontakt" description="Kontakt oss for spørsmål om Sky Planner. Vi hjelper deg gjerne.">
  <!-- Hero Section -->
  <section class="pt-32 pb-16 px-4 sm:px-6 lg:px-8">
    <div class="container-wide text-center">
      <Badge class="mb-6">Ta kontakt</Badge>
      <h1 class="text-4xl sm:text-5xl font-bold text-white mb-4">
        Vi hører gjerne fra deg
      </h1>
      <p class="text-lg text-dark-300 max-w-2xl mx-auto">
        Har du spørsmål om Sky Planner? Ønsker du en demo? Eller bare vil si hei?
        Fyll ut skjemaet under, så tar vi kontakt.
      </p>
    </div>
  </section>

  <!-- Contact Form & Info -->
  <section class="pb-20 px-4 sm:px-6 lg:px-8">
    <div class="container-wide">
      <div class="grid lg:grid-cols-3 gap-12">
        <!-- Contact Form -->
        <div class="lg:col-span-2">
          <GlassCard>
            <form id="contact-form" class="space-y-6">
              <div class="grid sm:grid-cols-2 gap-6">
                <div>
                  <label for="navn" class="input-label">Navn *</label>
                  <input
                    type="text"
                    id="navn"
                    name="navn"
                    required
                    class="input"
                    placeholder="Ditt navn"
                  />
                </div>
                <div>
                  <label for="epost" class="input-label">E-post *</label>
                  <input
                    type="email"
                    id="epost"
                    name="epost"
                    required
                    class="input"
                    placeholder="din@epost.no"
                  />
                </div>
              </div>

              <div class="grid sm:grid-cols-2 gap-6">
                <div>
                  <label for="telefon" class="input-label">Telefon</label>
                  <input
                    type="tel"
                    id="telefon"
                    name="telefon"
                    class="input"
                    placeholder="+47 xxx xx xxx"
                  />
                </div>
                <div>
                  <label for="bedrift" class="input-label">Bedrift</label>
                  <input
                    type="text"
                    id="bedrift"
                    name="bedrift"
                    class="input"
                    placeholder="Bedriftsnavn"
                  />
                </div>
              </div>

              <div>
                <label for="emne" class="input-label">Hva gjelder henvendelsen? *</label>
                <select id="emne" name="emne" required class="input">
                  <option value="">Velg emne...</option>
                  <option value="salg">Spørsmål om priser/salg</option>
                  <option value="demo">Ønsker demo</option>
                  <option value="support">Teknisk support</option>
                  <option value="annet">Annet</option>
                </select>
              </div>

              <div>
                <label for="melding" class="input-label">Melding *</label>
                <textarea
                  id="melding"
                  name="melding"
                  required
                  rows="5"
                  class="input resize-none"
                  placeholder="Skriv din melding her..."
                ></textarea>
              </div>

              <div id="form-message" class="hidden"></div>

              <button type="submit" class="btn-primary w-full sm:w-auto">
                <span id="btn-text">Send melding</span>
                <span id="btn-loading" class="hidden">Sender...</span>
              </button>
            </form>
          </GlassCard>
        </div>

        <!-- Contact Info -->
        <div class="space-y-6">
          <GlassCard>
            <h3 class="font-semibold text-white mb-4">Kontakt oss</h3>
            <div class="space-y-4">
              <div class="flex items-start gap-3">
                <div class="w-8 h-8 rounded-full bg-primary-500/10 flex items-center justify-center flex-shrink-0">
                  <span class="text-xs font-medium text-primary-400">SM</span>
                </div>
                <div>
                  <p class="font-medium text-white text-sm">Sander Martinsen</p>
                  <a href="tel:+4745140089" class="text-dark-400 hover:text-primary-400 text-sm block">+47 451 40 089</a>
                  <a href="mailto:sander@efffekt.no" class="text-dark-400 hover:text-primary-400 text-sm">sander@efffekt.no</a>
                </div>
              </div>
              <div class="flex items-start gap-3">
                <div class="w-8 h-8 rounded-full bg-primary-500/10 flex items-center justify-center flex-shrink-0">
                  <span class="text-xs font-medium text-primary-400">DB</span>
                </div>
                <div>
                  <p class="font-medium text-white text-sm">Daniel Barlag</p>
                  <a href="tel:+4798035064" class="text-dark-400 hover:text-primary-400 text-sm block">+47 980 35 064</a>
                  <a href="mailto:daniel@efffekt.no" class="text-dark-400 hover:text-primary-400 text-sm">daniel@efffekt.no</a>
                </div>
              </div>
            </div>
          </GlassCard>

          <GlassCard>
            <div class="flex items-start gap-4">
              <div class="w-10 h-10 rounded-lg bg-primary-500/10 flex items-center justify-center flex-shrink-0">
                <svg class="w-5 h-5 text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                </svg>
              </div>
              <div>
                <h3 class="font-semibold text-white mb-1">Bedrift</h3>
                <p class="text-dark-300">Efffekt AS</p>
                <p class="text-sm text-dark-500 mt-1">Org.nr: 937 019 793</p>
              </div>
            </div>
          </GlassCard>

          <GlassCard>
            <h3 class="font-semibold text-white mb-3">Ofte stilte spørsmål</h3>
            <p class="text-dark-400 text-sm mb-4">
              Kanskje finner du svaret du leter etter i vår FAQ.
            </p>
            <a href="/faq" class="text-primary-400 hover:text-primary-300 text-sm font-medium">
              Se FAQ →
            </a>
          </GlassCard>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const formMessage = document.getElementById('form-message');
  const btnText = document.getElementById('btn-text');
  const btnLoading = document.getElementById('btn-loading');

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    btnText?.classList.add('hidden');
    btnLoading?.classList.remove('hidden');
    formMessage?.classList.add('hidden');

    const formData = new FormData(form);
    const data = Object.fromEntries(formData);

    try {
      const response = await fetch('/api/contact', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data),
      });

      const result = await response.json();

      if (response.ok) {
        if (formMessage) {
          formMessage.className = 'form-success';
          formMessage.textContent = 'Takk for din henvendelse! Vi tar kontakt snart.';
          formMessage.classList.remove('hidden');
        }
        form.reset();
      } else {
        throw new Error(result.error || 'Noe gikk galt');
      }
    } catch (error) {
      if (formMessage) {
        formMessage.className = 'form-error';
        formMessage.textContent = error instanceof Error ? error.message : 'Noe gikk galt';
        formMessage.classList.remove('hidden');
      }
    } finally {
      btnText?.classList.remove('hidden');
      btnLoading?.classList.add('hidden');
    }
  });
</script>
